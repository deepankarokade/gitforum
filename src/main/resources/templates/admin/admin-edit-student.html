<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Edit Student - ExamPortal</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&family=Noto+Sans:wght@400;500;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#135bec",
                        "background-light": "#f6f6f8",
                        "background-dark": "#101622",
                    },
                    fontFamily: {
                        "display": ["Lexend", "sans-serif"],
                        "body": ["Noto Sans", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #334155;
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white antialiased">
    <div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden">
        <header
            class="sticky top-0 z-50 flex items-center justify-between whitespace-nowrap border-b border-solid border-slate-200 dark:border-slate-800 bg-white dark:bg-[#1a2231] px-6 lg:px-10 py-3 shadow-sm">
            <div class="flex items-center gap-4">
                <div class="flex size-10 items-center justify-center rounded-lg bg-primary/10 text-primary">
                    <span class="material-symbols-outlined text-2xl">school</span>
                </div>
                <h2 class="text-slate-900 dark:text-white text-xl font-bold leading-tight tracking-tight">ExamPortal
                </h2>
            </div>
            <button onclick="window.location.href='/admin/dashboard/student'"
                class="flex items-center gap-2 px-4 py-2 text-sm font-semibold text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">
                <span class="material-symbols-outlined text-lg">arrow_back</span>
                Back to Students
            </button>
        </header>
        <div class="layout-container flex h-full grow flex-col">
            <div class="flex flex-1 justify-center py-8 px-4 md:px-8">
                <div class="layout-content-container flex flex-col max-w-[1024px] flex-1 w-full gap-6">
                    <!-- Header Section -->
                    <div class="flex flex-col gap-2 md:flex-row md:justify-between md:items-end p-2">
                        <div class="flex flex-col gap-2">
                            <div class="flex items-center gap-3">
                                <h1 id="studentName"
                                    class="text-slate-900 dark:text-white text-3xl md:text-4xl font-black leading-tight tracking-tight">
                                    Loading...</h1>
                                <span id="studentUidBadge"
                                    class="inline-flex items-center gap-1 rounded-full bg-blue-50 dark:bg-blue-900/30 px-3 py-1 text-xs font-bold text-blue-700 dark:text-blue-300 ring-1 ring-inset ring-blue-700/10">
                                    <span class="material-symbols-outlined text-sm">badge</span>
                                    <span>Loading...</span>
                                </span>
                            </div>
                            <p class="text-slate-500 dark:text-slate-400 text-base font-normal leading-normal max-w-xl">
                                Update student information, academic details, and contact information. All changes will
                                be saved immediately upon submission.
                            </p>
                        </div>
                    </div>

                    <!-- Main Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Left Column: Form Details -->
                        <div class="lg:col-span-2 space-y-8">
                            <!-- Edit Form -->
                            <form id="studentEditForm"
                                class="flex flex-col gap-6 bg-white dark:bg-[#1a2231] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                                <div class="h-1 w-full bg-slate-100 dark:bg-slate-800">
                                    <div class="h-full w-3/4 bg-primary rounded-r-full"></div>
                                </div>
                                <div class="p-6 md:p-8 flex flex-col gap-8">
                                    <!-- Personal Information Section -->
                                    <section class="flex flex-col gap-6">
                                        <div
                                            class="flex items-center gap-3 border-b border-slate-100 dark:border-slate-800 pb-4">
                                            <div class="p-2 bg-primary/10 rounded-lg text-primary">
                                                <span class="material-symbols-outlined">person</span>
                                            </div>
                                            <h3 class="text-slate-900 dark:text-white text-lg font-bold">Personal
                                                Information
                                            </h3>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
                                            <div class="md:col-span-3 flex flex-col items-center justify-start gap-4">
                                                <div class="relative group cursor-pointer">
                                                    <div id="photoPreviewContainer"
                                                        class="size-32 md:size-40 rounded-full bg-slate-100 dark:bg-slate-700 border-4 border-white dark:border-slate-600 shadow-inner flex items-center justify-center overflow-hidden">
                                                        <span
                                                            class="material-symbols-outlined text-6xl text-slate-300 dark:text-slate-500 group-hover:hidden">person</span>
                                                        <div
                                                            class="absolute inset-0 bg-black/40 hidden group-hover:flex items-center justify-center text-white font-medium text-sm">
                                                            Change</div>
                                                    </div>
                                                    <div
                                                        class="absolute bottom-1 right-1 bg-primary text-white rounded-full p-2 border-2 border-white dark:border-slate-800 shadow-md">
                                                        <span
                                                            class="material-symbols-outlined text-sm block">edit</span>
                                                    </div>
                                                </div>
                                                <input type="file" id="photoInput" name="photo"
                                                    accept="image/jpeg,image/png" class="hidden" />
                                                <button type="button" id="uploadPhotoBtn"
                                                    class="text-primary text-sm font-semibold hover:underline">Upload
                                                    New
                                                    Photo</button>
                                                <p class="text-xs text-center text-slate-400 max-w-[150px]">Max size
                                                    2MB. JPG or
                                                    PNG only.</p>
                                            </div>
                                            <div class="md:col-span-9 grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <label class="flex flex-col gap-1.5 md:col-span-2">
                                                    <span
                                                        class="text-slate-700 dark:text-slate-300 text-sm font-medium">Full
                                                        Name</span>
                                                    <input name="fullName" id="fullName" required
                                                        class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 px-4"
                                                        placeholder="e.g. Johnathan Doe" type="text" />
                                                </label>
                                                <div class="flex flex-col gap-1.5">
                                                    <span
                                                        class="text-slate-700 dark:text-slate-300 text-sm font-medium">Date
                                                        of
                                                        Birth</span>
                                                    <input name="dob" id="dob"
                                                        class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 px-4"
                                                        type="date" />
                                                </div>
                                                <div class="flex flex-col gap-1.5">
                                                    <span
                                                        class="text-slate-700 dark:text-slate-300 text-sm font-medium flex items-center gap-1">
                                                        Student UID
                                                        <span
                                                            class="material-symbols-outlined text-xs text-slate-400">lock</span>
                                                    </span>
                                                    <input id="uid" readonly
                                                        class="form-input w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 text-slate-500 h-12 px-4 cursor-not-allowed"
                                                        type="text" />
                                                </div>
                                                <div class="flex flex-col gap-2 md:col-span-2">
                                                    <span
                                                        class="text-slate-700 dark:text-slate-300 text-sm font-medium">Gender</span>
                                                    <div class="flex flex-wrap gap-4">
                                                        <label
                                                            class="flex items-center gap-2 cursor-pointer p-3 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-white dark:hover:bg-slate-800 transition-colors flex-1 min-w-[120px]">
                                                            <input
                                                                class="size-4 text-primary focus:ring-primary border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700"
                                                                name="gender" id="genderMale" value="Male"
                                                                type="radio" />
                                                            <span
                                                                class="text-sm font-medium text-slate-700 dark:text-slate-300">Male</span>
                                                        </label>
                                                        <label
                                                            class="flex items-center gap-2 cursor-pointer p-3 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-white dark:hover:bg-slate-800 transition-colors flex-1 min-w-[120px]">
                                                            <input
                                                                class="size-4 text-primary focus:ring-primary border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700"
                                                                name="gender" id="genderFemale" value="Female"
                                                                type="radio" />
                                                            <span
                                                                class="text-sm font-medium text-slate-700 dark:text-slate-300">Female</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </section>

                                    <!-- Contact Details Section -->
                                    <section class="flex flex-col gap-6">
                                        <div
                                            class="flex items-center gap-3 border-b border-slate-100 dark:border-slate-800 pb-4">
                                            <div class="p-2 bg-primary/10 rounded-lg text-primary">
                                                <span class="material-symbols-outlined">call</span>
                                            </div>
                                            <h3 class="text-slate-900 dark:text-white text-lg font-bold">Contact Details
                                            </h3>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <label class="flex flex-col gap-1.5">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">Email
                                                    Address</span>
                                                <div class="relative">
                                                    <span
                                                        class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-[20px]">mail</span>
                                                    <input id="email" name="email"
                                                        class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 pl-11 pr-4"
                                                        placeholder="student@example.com" type="email" />
                                                </div>
                                            </label>
                                            <label class="flex flex-col gap-1.5">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">Contact
                                                    Number</span>
                                                <div class="relative">
                                                    <span
                                                        class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-[20px]">phone</span>
                                                    <input id="contactNumber" name="contactNumber"
                                                        class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 pl-11 pr-4"
                                                        placeholder="+1 (555) 000-0000" type="tel" />
                                                </div>
                                            </label>
                                            <label class="flex flex-col gap-1.5 md:col-span-2">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">Residential
                                                    Address</span>
                                                <input id="address" name="address"
                                                    class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 px-4"
                                                    placeholder="Apartment, Street, Area" type="text" />
                                            </label>
                                            <label class="flex flex-col gap-1.5">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">State/Province</span>
                                                <select id="state" name="state"
                                                    class="form-select w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary h-12 px-3">
                                                    <option disabled value="">Select State</option>
                                                    <option>Maharashtra</option>
                                                    <option>Gujrat</option>
                                                    <option>Tamilnaudu</option>
                                                </select>
                                            </label>
                                            <label class="flex flex-col gap-1.5">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">City</span>
                                                <input id="city" name="city"
                                                    class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 px-4"
                                                    placeholder="e.g. Pune" type="text" />
                                            </label>
                                        </div>
                                    </section>

                                    <!-- Guardian / Parent Information Section -->
                                    <section class="flex flex-col gap-6">
                                        <div
                                            class="flex items-center gap-3 border-b border-slate-100 dark:border-slate-800 pb-4">
                                            <div class="p-2 bg-primary/10 rounded-lg text-primary">
                                                <span class="material-symbols-outlined">family_restroom</span>
                                            </div>
                                            <h3 class="text-slate-900 dark:text-white text-lg font-bold">Guardian /
                                                Parent
                                                Information</h3>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <label class="flex flex-col gap-1.5">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">Guardian
                                                    /
                                                    Parent Name</span>
                                                <input id="parentName" name="parentName"
                                                    class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 px-4"
                                                    placeholder="Full Name" type="text" />
                                            </label>
                                            <label class="flex flex-col gap-1.5">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">Guardian
                                                    /
                                                    Parent Contact</span>
                                                <input id="parentContact" name="parentContact"
                                                    class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 px-4"
                                                    placeholder="Phone Number" type="tel" />
                                            </label>
                                        </div>
                                    </section>

                                    <!-- Academic & Exam Details Section -->
                                    <section class="flex flex-col gap-6">
                                        <div
                                            class="flex items-center gap-3 border-b border-slate-100 dark:border-slate-800 pb-4">
                                            <div class="p-2 bg-primary/10 rounded-lg text-primary">
                                                <span class="material-symbols-outlined">school</span>
                                            </div>
                                            <h3 class="text-slate-900 dark:text-white text-lg font-bold">Academic & Exam
                                                Details</h3>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <label class="flex flex-col gap-1.5 md:col-span-2">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">College
                                                    Name</span>
                                                <input id="schoolCollegeName" name="schoolCollegeName"
                                                    class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 px-4"
                                                    placeholder="Enter institution name" type="text" />
                                            </label>
                                            <label class="flex flex-col gap-1.5">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">Class</span>
                                                <input id="studentClass" name="studentClass"
                                                    class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 px-4"
                                                    placeholder="e.g. 11th / 12th" type="text" />
                                            </label>
                                            <label class="flex flex-col gap-1.5">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">Registration/Student
                                                    ID <span class="text-slate-400 font-normal">(Optional)</span></span>
                                                <input id="registrationId" name="registrationId"
                                                    class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 px-4"
                                                    placeholder="Enter ID if available" type="text" />
                                            </label>
                                            <label class="flex flex-col gap-1.5 md:col-span-2">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">Preferred
                                                    Exam Date <span
                                                        class="text-slate-400 font-normal">(Optional)</span></span>
                                                <input id="preferredExamDate" name="preferredExamDate"
                                                    class="form-input w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary placeholder:text-slate-400 h-12 px-4"
                                                    type="date" />
                                            </label>
                                            <label class="flex flex-col gap-1.5 md:col-span-2">
                                                <span
                                                    class="text-slate-700 dark:text-slate-300 text-sm font-medium">Subjects
                                                    /
                                                    Courses</span>
                                                <select id="subjects" name="subjects"
                                                    class="form-select w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:border-primary focus:ring-primary h-12 px-3">
                                                    <option disabled value="">Loading courses...</option>
                                                </select>
                                            </label>
                                        </div>
                                    </section>

                                    <!-- Action Buttons -->
                                    <div
                                        class="flex flex-col-reverse md:flex-row items-center justify-end gap-4 border-t border-slate-100 dark:border-slate-800 pt-6 mt-2">
                                        <button
                                            class="w-full md:w-auto px-6 py-3 rounded-lg text-slate-500 dark:text-slate-400 font-semibold hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
                                            type="button" onclick="window.location.href='/admin/dashboard/student'">
                                            Cancel
                                        </button>
                                        <button
                                            class="w-full md:w-auto md:min-w-[160px] justify-center px-6 py-3 rounded-lg bg-primary text-white font-bold hover:bg-blue-700 transition-colors shadow-lg shadow-blue-500/30 flex items-center gap-2"
                                            type="submit">
                                            <span class="material-symbols-outlined text-sm">save</span>
                                            <span>Update Student</span>
                                        </button>
                                    </div>
                                </div>
                        </div>
                        </form>
                    </div>

                    <!-- Right Column: Activity Panel & Actions -->
                    <div class="space-y-6">
                        <!-- Activity Status Panel -->
                        <div
                            class="bg-white dark:bg-[#1a2231] rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 p-6">
                            <h3 class="text-lg font-bold mb-1 flex items-center gap-2">
                                <span class="material-symbols-outlined text-yellow-500">report</span>
                                Account Actions
                            </h3>
                            <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">
                                Status: <span id="activityStatus" class="text-green-600 font-bold">Active</span>
                            </p>
                            <div class="flex flex-col gap-3">
                                <button id="activateBtn" type="button"
                                    class="group flex items-center justify-between w-full px-4 py-3 rounded-lg border border-green-500/30 text-green-600 font-bold hover:bg-green-500 hover:text-white transition-all text-sm hidden">
                                    <span class="flex items-center gap-2">
                                        <span class="material-symbols-outlined text-lg">check_circle</span>
                                        Activate Account
                                    </span>
                                    <span
                                        class="material-symbols-outlined opacity-0 group-hover:opacity-100 text-sm">chevron_right</span>
                                </button>
                                <button id="deactivateBtn" type="button"
                                    class="group flex items-center justify-between w-full px-4 py-3 rounded-lg border border-yellow-500/30 text-yellow-600 font-bold hover:bg-yellow-500 hover:text-white transition-all text-sm hidden">
                                    <span class="flex items-center gap-2">
                                        <span class="material-symbols-outlined text-lg">block</span>
                                        Deactivate Account
                                    </span>
                                    <span
                                        class="material-symbols-outlined opacity-0 group-hover:opacity-100 text-sm">chevron_right</span>
                                </button>
                                <div class="h-px bg-slate-100 dark:bg-slate-800 my-2"></div>
                                <button id="deleteBtn" type="button"
                                    class="group flex items-center justify-between w-full px-4 py-3 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400 font-bold hover:bg-red-500 hover:text-white transition-all text-sm">
                                    <span class="flex items-center gap-2">
                                        <span class="material-symbols-outlined text-lg">delete_forever</span>
                                        Delete Account
                                    </span>
                                    <span
                                        class="material-symbols-outlined opacity-0 group-hover:opacity-100 text-sm">priority_high</span>
                                </button>
                            </div>
                            <p class="text-[11px] text-slate-400 mt-6 leading-relaxed">
                                Deleting an account is permanent and will remove all student data and exam history. We
                                recommend deactivation instead.
                            </p>
                        </div>

                        <!-- Info Panel -->
                        <div class="bg-primary/5 dark:bg-primary/10 rounded-xl p-6 border border-primary/10">
                            <h3 class="text-sm font-bold text-primary mb-2">Pro-Tip</h3>
                            <p class="text-xs text-primary/80 leading-normal">
                                Student records can be exported for analysis. Use the Reports module to generate
                                detailed performance insights.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
    <script>
        const BASE_URL = 'http://localhost:8081';
        const COURSE_API_URL = 'http://localhost:8081/admin/course';
        const urlParams = new URLSearchParams(window.location.search);
        const studentUid = urlParams.get('uid');
        let currentSubjects = ''; // Store current subject for later selection

        if (!studentUid) {
            alert('No student UID provided!');
            window.location.href = `${BASE_URL}/admin/dashboard/student`;
        }

        // Load courses for subjects dropdown
        async function loadCoursesForDropdown() {
            const subjectsDropdown = document.getElementById('subjects');
            if (!subjectsDropdown) return;

            try {
                const response = await fetch(COURSE_API_URL);
                if (!response.ok) throw new Error('Failed to fetch courses');

                const courses = await response.json();

                // Clear existing options
                subjectsDropdown.innerHTML = '<option disabled value="">Select primary subject stream</option>';

                // Add courses as options
                courses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.courseName;
                    option.textContent = course.courseName;
                    subjectsDropdown.appendChild(option);
                });

                // If we already loaded the student data, select the current subject
                if (currentSubjects) {
                    subjectsDropdown.value = currentSubjects;
                }
            } catch (error) {
                console.error('Error loading courses:', error);
                subjectsDropdown.innerHTML = '<option disabled selected value="">Failed to load courses</option>';
            }
        }

        // Load courses on page load
        document.addEventListener('DOMContentLoaded', loadCoursesForDropdown);

        // Photo upload functionality
        const photoInput = document.getElementById('photoInput');
        const uploadPhotoBtn = document.getElementById('uploadPhotoBtn');
        const photoPreviewContainer = document.getElementById('photoPreviewContainer');

        uploadPhotoBtn.addEventListener('click', () => {
            photoInput.click();
        });

        photoPreviewContainer.addEventListener('click', () => {
            photoInput.click();
        });

        photoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                // Validate file size (2MB max)
                if (file.size > 2 * 1024 * 1024) {
                    alert('File size must be less than 2MB');
                    photoInput.value = '';
                    return;
                }

                // Validate file type
                if (!['image/jpeg', 'image/png'].includes(file.type)) {
                    alert('Only JPG and PNG files are allowed');
                    photoInput.value = '';
                    return;
                }

                // Preview the image
                const reader = new FileReader();
                reader.onload = (e) => {
                    photoPreviewContainer.innerHTML = `<img src="${e.target.result}" alt="Preview" class="w-full h-full object-cover" />`;
                };
                reader.readAsDataURL(file);
            }
        });

        // Fetch student data and populate form
        async function loadStudentData() {
            try {
                const response = await fetch(`${BASE_URL}/admin/student/${studentUid}`);
                if (response.ok) {
                    const student = await response.json();

                    // Update header
                    document.getElementById('studentName').textContent = student.fullName || 'Unknown Student';
                    document.getElementById('studentUidBadge').innerHTML = `
                        <span class="material-symbols-outlined text-sm">badge</span>
                        <span>${student.uid || 'N/A'}</span>
                    `;

                    // Populate form fields
                    document.getElementById('uid').value = student.uid || '';
                    document.getElementById('fullName').value = student.fullName || '';
                    document.getElementById('dob').value = student.dob || '';
                    document.getElementById('email').value = student.email || '';
                    document.getElementById('contactNumber').value = student.contactNumber || '';
                    document.getElementById('address').value = student.address || '';
                    document.getElementById('state').value = student.state || '';
                    document.getElementById('city').value = student.city || '';
                    document.getElementById('parentName').value = student.parentName || '';
                    document.getElementById('parentContact').value = student.parentContact || '';
                    document.getElementById('schoolCollegeName').value = student.schoolCollegeName || '';
                    document.getElementById('studentClass').value = student.studentClass || '';
                    document.getElementById('registrationId').value = student.registrationId || '';
                    document.getElementById('preferredExamDate').value = student.preferredExamDate || '';

                    // Store subject and try to select it (courses might still be loading)
                    currentSubjects = student.subjects || '';
                    document.getElementById('subjects').value = currentSubjects;

                    // Set gender radio button
                    if (student.gender === 'Male') {
                        document.getElementById('genderMale').checked = true;
                    } else if (student.gender === 'Female') {
                        document.getElementById('genderFemale').checked = true;
                    }

                    // Load photo if available
                    if (student.photo) {
                        // Assuming photo is base64 encoded or a URL
                        photoPreviewContainer.innerHTML = `<img src="data:image/jpeg;base64,${student.photo}" alt="Student Photo" class="w-full h-full object-cover" />`;
                    }

                    // Load and update activity status from dedicated endpoint
                    loadActivityStatus();

                } else {
                    alert('Failed to load student data');
                    window.location.href = `${BASE_URL}/admin/dashboard/student`;
                }
            } catch (error) {
                console.error('Error loading student data:', error);
                alert('Error loading student data. Please try again.');
            }
        }

        // Load activity status from dedicated endpoint
        async function loadActivityStatus() {
            try {
                console.log('Fetching activity status for UID:', studentUid);
                const response = await fetch(`${BASE_URL}/admin/student/${studentUid}/status`);
                console.log('Status API response:', response);

                if (response.ok) {
                    const status = await response.text(); // Returns "ACTIVE", "INACTIVE", or "DELETED"
                    console.log('Received status from API:', status, 'Type:', typeof status);
                    updateStatusDisplay(status);
                } else {
                    console.error('Failed to load activity status, response not ok');
                    // Default to ACTIVE if we can't fetch
                    updateStatusDisplay('ACTIVE');
                }
            } catch (error) {
                console.error('Error loading activity status:', error);
                // Default to ACTIVE if there's an error
                updateStatusDisplay('ACTIVE');
            }
        }

        // Load student data on page load
        loadStudentData();

        // Form submission
        const form = document.getElementById('studentEditForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();

            // Append all form data (except photo)
            formData.append('fullName', document.getElementById('fullName').value);
            formData.append('dob', document.getElementById('dob').value);
            formData.append('gender', document.querySelector('input[name="gender"]:checked')?.value || '');
            formData.append('email', document.getElementById('email').value);
            formData.append('contactNumber', document.getElementById('contactNumber').value);
            formData.append('address', document.getElementById('address').value);
            formData.append('state', document.getElementById('state').value);
            formData.append('city', document.getElementById('city').value);
            formData.append('parentName', document.getElementById('parentName').value);
            formData.append('parentContact', document.getElementById('parentContact').value);
            formData.append('schoolCollegeName', document.getElementById('schoolCollegeName').value);
            formData.append('studentClass', document.getElementById('studentClass').value);
            formData.append('registrationId', document.getElementById('registrationId').value);
            formData.append('preferredExamDate', document.getElementById('preferredExamDate').value);
            formData.append('subjects', document.getElementById('subjects').value);

            // Show loading state
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalBtnContent = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = `
                <div class="flex items-center gap-2">
                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                    <span>Updating...</span>
                </div>
            `;

            try {
                // First, update student data
                const response = await fetch(`${BASE_URL}/admin/student/edit/${studentUid}`, {
                    method: 'PUT',
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(error);
                }

                // If photo was changed, update it separately
                if (photoInput.files[0]) {
                    const photoFormData = new FormData();
                    photoFormData.append('photo', photoInput.files[0]);

                    const photoResponse = await fetch(`${BASE_URL}/admin/student/photo/${studentUid}`, {
                        method: 'PUT',
                        body: photoFormData
                    });

                    if (!photoResponse.ok) {
                        const photoError = await photoResponse.text();
                        console.warn('Photo update failed:', photoError);
                        alert('‚ö†Ô∏è Student data updated but photo update failed: ' + photoError);
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalBtnContent;
                        return;
                    }
                }

                const message = await response.text();
                alert('‚úÖ ' + message + (photoInput.files[0] ? ' (including photo)' : ''));
                // Redirect back to student management page
                window.location.href = `${BASE_URL}/admin/dashboard/student`;
            } catch (error) {
                console.error('Error updating student:', error);
                alert('‚ùå Failed to update student: ' + error.message);
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnContent;
            }
        });

        // Account Action Handlers
        const activateBtn = document.getElementById('activateBtn');
        const deactivateBtn = document.getElementById('deactivateBtn');
        const deleteBtn = document.getElementById('deleteBtn');

        // Update button visibility based on current status
        function updateAccountActionButtons(status) {
            // Clean the status - remove quotes and trim whitespace
            const cleanStatus = status.replace(/['"]/g, '').trim();
            console.log('üîÑ Original status:', status, '‚Üí Clean status:', cleanStatus);

            // Hide all first
            activateBtn.classList.add('hidden');
            deactivateBtn.classList.remove('hidden');
            deleteBtn.classList.remove('hidden');

            // Show/hide based on status
            if (cleanStatus === 'ACTIVE') {
                console.log('‚úÖ ACTIVE - showing deactivate, hiding activate');
                activateBtn.classList.add('hidden');
                deactivateBtn.classList.remove('hidden');
            } else if (cleanStatus === 'INACTIVE') {
                console.log('‚ùå INACTIVE - showing activate, hiding deactivate');
                activateBtn.classList.remove('hidden');
                deactivateBtn.classList.add('hidden');
            } else if (cleanStatus === 'DELETED') {
                console.log('üóëÔ∏è DELETED - showing activate, hiding deactivate');
                activateBtn.classList.remove('hidden');
                deactivateBtn.classList.add('hidden');
            }

            console.log('Final state - Activate hidden?', activateBtn.classList.contains('hidden'));
            console.log('Final state - Deactivate hidden?', deactivateBtn.classList.contains('hidden'));
        }

        // Update status in UI
        function updateStatusDisplay(status) {
            const statusElement = document.getElementById('activityStatus');
            if (statusElement) {
                statusElement.textContent = status;
                // Update color based on status
                if (status === 'ACTIVE') {
                    statusElement.className = 'text-green-600 font-bold';
                } else if (status === 'INACTIVE') {
                    statusElement.className = 'text-gray-600 font-bold';
                } else if (status === 'BLOCKED') {
                    statusElement.className = 'text-orange-600 font-bold';
                } else if (status === 'DELETED') {
                    statusElement.className = 'text-red-600 font-bold';
                }
            }
            updateAccountActionButtons(status);
        }

        // Activate Account
        if (activateBtn) {
            activateBtn.addEventListener('click', async function () {
                if (!confirm('Are you sure you want to activate this student account?')) return;

                try {
                    const response = await fetch(`${BASE_URL}/admin/student/${studentUid}/activate`, {
                        method: 'PUT'
                    });

                    if (response.ok) {
                        alert('‚úÖ Student account activated successfully!');
                        updateStatusDisplay('ACTIVE');
                    } else {
                        throw new Error('Failed to activate');
                    }
                } catch (error) {
                    console.error('Error activating account:', error);
                    alert('‚ùå Failed to activate account');
                }
            });
        }

        // Deactivate Account
        if (deactivateBtn) {
            deactivateBtn.addEventListener('click', async function () {
                if (!confirm('Are you sure you want to deactivate this student account? The student will not be able to log in.')) return;

                try {
                    const response = await fetch(`${BASE_URL}/admin/student/${studentUid}/deactivate`, {
                        method: 'PUT'
                    });

                    if (response.ok) {
                        alert('‚úÖ Student account deactivated successfully!');
                        updateStatusDisplay('INACTIVE');
                    } else {
                        throw new Error('Failed to deactivate');
                    }
                } catch (error) {
                    console.error('Error deactivating account:', error);
                    alert('‚ùå Failed to deactivate account');
                }
            });
        }

        // Delete Account (Mark as deleted)
        if (deleteBtn) {
            deleteBtn.addEventListener('click', async function () {
                if (!confirm('‚ö†Ô∏è Are you sure you want to DELETE this student account? This action marks the account as deleted and cannot be easily undone.')) return;

                try {
                    const response = await fetch(`${BASE_URL}/admin/student/${studentUid}/delete`, {
                        method: 'PUT'
                    });

                    if (response.ok) {
                        alert('‚úÖ Student account marked as deleted!');
                        updateStatusDisplay('DELETED');

                        // Optionally redirect after a delay
                        setTimeout(() => {
                            if (confirm('Return to student list?')) {
                                window.location.href = `${BASE_URL}/admin/dashboard/student`;
                            }
                        }, 2000);
                    } else {
                        throw new Error('Failed to delete');
                    }
                } catch (error) {
                    console.error('Error deleting account:', error);
                    alert('‚ùå Failed to delete account');
                }
            });
        }

    </script>
</body>

</html>