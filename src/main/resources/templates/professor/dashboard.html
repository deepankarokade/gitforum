<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>Professor Dashboard</title>
	<link rel="stylesheet" th:href="@{/css/dashboard.css}">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

	<!-- ⚠️ CSS SAME AS YOUR FILE (UNCHANGED) -->
	<style>
		/* SAME CSS – NOT MODIFIED */
		body {
			margin: 0;
			font-family: "Segoe UI", sans-serif;
			background: linear-gradient(to right, #e0f7fa, #f4f6fb);
		}

		.navbar {
			background: linear-gradient(90deg, #1e3c72, #2a5298);
			padding: 15px 30px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			color: white;
		}

		.logo {
			font-size: 22px;
			font-weight: bold;
		}

		.nav-right a,
		.profile-dropdown span {
			margin-left: 20px;
			color: white;
			text-decoration: none;
		}

		.profile-dropdown {
			position: relative;
			cursor: pointer;
		}

		.dropdown-content {
			display: none;
			position: absolute;
			right: 0;
			background: white;
			border-radius: 6px;
		}

		.profile-dropdown:hover .dropdown-content {
			display: block;
		}

		.container {
			padding: 30px;
			background: white;
			border-radius: 15px;
			margin: 20px;
		}

		.cards {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
			gap: 20px;
		}

		.card {
			background: linear-gradient(135deg, #6dd5fa, #2980b9);
			color: white;
			padding: 20px;
			border-radius: 12px;
			text-align: center;
		}

		.grid {
			display: grid;
			gap: 20px;
			grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
			margin-top: 30px;
		}

		table {
			width: 100%;
			border-collapse: collapse;
		}

		th,
		td {
			padding: 10px;
			font-size: 14px;
		}

		th {
			background: #f1f5f9;
		}

		tr:nth-child(even) {
			background: #f9f9f9;
		}

		.btn {
			background: #2563eb;
			color: white;
			padding: 6px 14px;
			border-radius: 6px;
			text-decoration: none;
		}

		.btn-create {
			background: #ff7f50;
		}

		.empty {
			text-align: center;
			color: gray;
			padding: 15px;
		}

		ul {
			list-style: none;
			padding: 0;
		}

		.activity-time {
			font-size: 12px;
			color: gray;
			margin-right: 5px;
		}
	</style>
</head>

<body>

	<!-- NAVBAR -->
	<div class="navbar">
		<div class="logo">Online Examination Portal</div>
		<div class="nav-right">
			<a class="active">Dashboard</a>
			<a th:href="@{/professor/exams}">Exams</a>
			<a th:href="@{/professor/students}">Students</a>
			<a th:href="@{/professor/results}">Results</a>
			<a th:href="@{/professor/certificates}">Certificates</a>

			<div class="profile-dropdown">
				<span th:text="${professorName}">Professor</span>
				<div class="dropdown-content">
					<a th:href="@{/professor/settings}">Settings</a>
					<a th:href="@{/logout}">Logout</a>
				</div>
			</div>
		</div>
	</div>

	<div class="container">
		<h2>Welcome, <span th:text="${professorName}">Professor</span></h2>

		<!-- STATS -->
		<div class="cards">
			<div class="card">
				<h1 th:text="${totalStudents}">0</h1>
				<p>Total Students</p>
			</div>
			<div class="card">
				<h1 th:text="${totalExams}">0</h1>
				<p>Total Exams</p>
			</div>
			<div class="card">
				<h1 th:text="${liveExams}">0</h1>
				<p>Live Exams</p>
			</div>
			<div class="card">
			    <h1 th:text="${upcomingExams}">0</h1>
			    <p>Upcoming Exams</p>
			</div>

			<div class="card">
				<h1 th:text="${resultsPublished}">0</h1>
				<p>Results</p>
			</div>
		</div>

		<div class="grid">

			<!-- EXAMS -->
			<div>
				<h3>Manage Exams</h3>
				<a th:href="@{/professor/exams/create}" class="btn btn-create">Create Exam</a>
				<a th:href="@{/professor/exams}" class="btn">View All</a>

				<table>
					<thead>
						<tr>
							<th>Exam</th>
							<th>Course</th>
							<th>Duration</th>
							<th>Total Marks</th>
							<th>Status</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody id="examTableBody"></tbody>
				</table>
			</div>

			<!-- STUDENTS -->
			<div>
				<h3>Students Overview</h3>
				<table>
					<thead>
						<tr>
							<th>Name</th>
							<th>Email</th>
							<th>Enrollment Date</th>
						</tr>
					</thead>
					<tbody id="studentTableBody"></tbody>
				</table>
			</div>

			<!-- ACTIVITIES -->
			<div>
				<h3>Recent Activities</h3>
				<ul id="activityList"></ul>
			</div>

		</div>
	</div>

	<!-- ================= AJAX ONLY ================= -->
	<script>
		document.addEventListener("DOMContentLoaded", () => {
			fetch("/professor/exams/list")

				.then(r => r.json())
				.then(data => {
				    let limited = data.slice(0, 5);

				    let html = limited.length === 0
				        ? `<tr><td colspan="6" class="empty">No exams created yet</td></tr>`
				        : limited.map(e => `
				            <tr>
				                <td>${e.title}</td>
				                <td>${e.course}</td>
				                <td>${e.duration}</td>
				                <td>${e.totalMarks}</td>
				                <td>${e.status}</td>
				                <td>
				                    <button class="btn" onclick="updateExam(${e.id})">Update</button>
				                </td>
				            </tr>
				        `).join("");

				    document.getElementById("examTableBody").innerHTML = html;
				});


			fetch("/professor/api/students")
				.then(r => r.json())
				.then(data => {
					let html = data.length === 0
						? `<tr><td colspan="3" class="empty">No students available</td></tr>`
						: data.map(s => `
                    <tr>
                        <td>${s.name}</td>
                        <td>${s.email}</td>
                        <td>${s.enrolledDate}</td>
                    </tr>`).join("");
					document.getElementById("studentTableBody").innerHTML = html;
				});

			fetch("/professor/api/activities")
				.then(r => r.json())
				.then(data => {
					let html = data.length === 0
						? `<li class="empty">No recent activities</li>`
						: data.map(a => `
                    <li>
                        <span class="activity-time">${a.time}</span>
                        ${a.description}
                    </li>`).join("");
					document.getElementById("activityList").innerHTML = html;
				});
		});

		function updateExam(id) {

			window.location.href = `/professor/exams/update/${id}`;
		}

		function rescheduleExam(id) {
			let newStart = prompt("Enter new start date & time (YYYY-MM-DDTHH:MM):");
			let newEnd = prompt("Enter new end date & time (YYYY-MM-DDTHH:MM):");

			if (newStart && newEnd) {
				fetch(`/professor/exams/reschedule/${id}`, {
					method: 'PUT',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify({startDate: newStart, endDate: newEnd})
				})
					.then(r => r.json())
					.then(() => location.reload());
			}
		}

		function deleteExam(id) {
			if (confirm("Are you sure you want to delete this exam?")) {
				fetch(`/professor/exams/delete/${id}`, {method: 'DELETE'})
					.then(() => location.reload());
			}
		}

	</script>



</body>

</html>