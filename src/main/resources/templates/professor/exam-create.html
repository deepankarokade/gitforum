<!DOCTYPE html>
<html class="light" lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8" />
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<title th:text="${exam.id != null ? 'Update Exam' : 'Create Exam'}">Create Exam - ExamPortal</title>
	<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
	<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700;800&display=swap"
		rel="stylesheet" />
	<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
		rel="stylesheet" />
	<script>
		tailwind.config = {
			darkMode: "class",
			theme: {
				extend: {
					colors: {
						"primary": "#135bec",
						"background-light": "#f6f6f8",
						"background-dark": "#101622",
					},
					fontFamily: {
						"display": ["Lexend", "sans-serif"]
					},
					borderRadius: {
						"DEFAULT": "0.25rem",
						"lg": "0.5rem",
						"xl": "0.75rem",
						"2xl": "1rem",
						"3xl": "1.5rem",
						"full": "9999px"
					},
				},
			},
		}
	</script>
	<style>
		body {
			font-family: 'Lexend', sans-serif;
		}

		.geometric-bg {
			background-color: #f6f6f8;
			background-image: radial-gradient(#135bec11 1px, transparent 1px);
			background-size: 24px 24px;
		}

		.dark .geometric-bg {
			background-color: #101622;
			background-image: radial-gradient(#135bec22 1px, transparent 1px);
		}

		/* Custom scrollbar */
		::-webkit-scrollbar {
			width: 6px;
		}

		::-webkit-scrollbar-track {
			background: transparent;
		}

		::-webkit-scrollbar-thumb {
			background: #cbd5e1;
			border-radius: 3px;
		}

		.dark ::-webkit-scrollbar-thumb {
			background: #475569;
		}

		.glass-card {
			background: rgba(255, 255, 255, 0.8);
			backdrop-filter: blur(12px);
			-webkit-backdrop-filter: blur(12px);
		}

		.dark .glass-card {
			background: rgba(30, 41, 59, 0.7);
		}

		/* Input focus animation */
		.form-input-premium {
			@apply w-full px-5 py-3.5 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-800/50 text-slate-900 dark:text-white placeholder-slate-400 focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-300 outline-none hover:border-primary/30;
		}

		.form-input-premium:focus {
			transform: translateY(-2px);
			box-shadow: 0 10px 20px -5px rgba(19, 91, 236, 0.1);
		}

		/* Checkbox styling */
		.custom-checkbox:checked {
			background-color: #135bec;
			border-color: #135bec;
		}

		.animate-slide-up {
			animation: slideUp 0.5s ease-out forwards;
		}

		@keyframes slideUp {
			from {
				opacity: 0;
				transform: translateY(20px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
	</style>
</head>

<body
	class="bg-background-light dark:bg-background-dark text-[#111318] dark:text-white antialiased transition-colors duration-300">
	<div class="flex h-screen overflow-hidden">
		<!-- Sidebar Navigation -->
		<aside
			class="w-72 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex flex-col justify-between py-6 transition-all duration-300">
			<div class="flex flex-col gap-8 px-6">
				<!-- Profile Section -->
				<div class="flex gap-3 items-center">
					<div id="sidebarAvatar"
						class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-12 border-2 border-primary bg-gradient-to-br from-primary/20 to-purple-500/20 flex items-center justify-center">
						<span class="material-symbols-outlined text-primary text-2xl">person</span>
					</div>
					<div class="flex flex-col">
						<h1 id="sidebarProfName"
							class="text-[#111318] dark:text-white text-base font-semibold leading-tight">Professor</h1>
						<h5 class="text-slate-500 dark:text-slate-400 text-sm font-normal leading-tight">Faculty</h5>
					</div>
				</div>
				<!-- Nav Links -->
				<nav class="flex flex-col gap-1 overflow-y-auto max-h-[calc(100vh-250px)] pr-2">
					<a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-all font-medium"
						th:href="@{/professor/dashboard}">
						<span class="material-symbols-outlined">dashboard</span>
						<p class="text-sm">Dashboard</p>
					</a>

					<!-- Manage Exam Dropdown -->
					<div class="relative">
						<button id="manageExamBtn"
							class="w-full flex items-center justify-between px-4 py-3 rounded-xl bg-primary/10 text-primary transition-all group font-bold">
							<div class="flex items-center gap-3">
								<span class="material-symbols-outlined fill-1">quiz</span>
								<p class="text-sm">Manage Exam</p>
							</div>
							<span id="manageExamArrow"
								class="material-symbols-outlined text-sm transition-transform duration-200 rotate-180">expand_more</span>
						</button>
						<div id="manageExamSub"
							class="flex flex-col gap-1 mt-1 ml-4 border-l-2 border-primary/20 dark:border-primary/40 pl-4 transition-all">
							<a class="flex items-center gap-3 px-4 py-2 rounded-lg text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-white transition-all font-medium"
								th:href="@{/professor/exams}">
								<span class="material-symbols-outlined text-xs">list_alt</span>
								<p class="text-xs">All Exams</p>
							</a>
							<a class="flex items-center gap-3 px-4 py-2 rounded-lg text-primary font-bold transition-all"
								th:href="@{/professor/exams/create}">
								<span class="material-symbols-outlined text-xs">add_circle</span>
								<p class="text-xs">Create Exam</p>
							</a>
							<a class="flex items-center gap-3 px-4 py-2 rounded-lg text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-white transition-all font-medium"
								th:href="@{/professor/exams/set-questions}">
								<span class="material-symbols-outlined text-xs">format_list_bulleted</span>
								<p class="text-xs">Set Questions</p>
							</a>
						</div>
					</div>

					<a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-all font-medium"
						th:href="@{/professor/monitoring}">
						<span class="material-symbols-outlined">monitoring</span>
						<p class="text-sm">Monitoring</p>
					</a>

					<a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-all font-medium"
						th:href="@{/professor/students}">
						<span class="material-symbols-outlined">group</span>
						<p class="text-sm">Student Management</p>
					</a>
				</nav>
			</div>
			<!-- Footer Sidebar -->
			<div class="flex flex-col gap-1 px-6">
				<button id="darkModeToggle"
					class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-all">
					<span class="material-symbols-outlined">dark_mode</span>
					<p class="text-sm font-medium">Appearance</p>
					<div class="ml-auto">
						<div
							class="relative inline-block w-10 h-5 rounded-full bg-gray-300 dark:bg-primary transition-colors">
							<div
								class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform dark:transform dark:translate-x-5">
							</div>
						</div>
					</div>
				</button>
				<a class="flex items-center gap-3 px-4 py-3 rounded-xl text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all font-medium"
					th:href="@{/logout}">
					<span class="material-symbols-outlined">logout</span>
					<p class="text-sm">Logout</p>
				</a>
			</div>
		</aside>

		<!-- Main Content Area -->
		<main class="flex-1 flex flex-col overflow-y-auto geometric-bg">
			<!-- Top Navigation Bar -->
			<header
				class="flex items-center justify-between sticky top-0 z-20 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 px-8 py-4">
				<div class="flex items-center gap-6">
					<div class="flex items-center gap-2">
						<div class="text-primary bg-primary/10 p-2 rounded-xl">
							<svg class="size-7" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
								<path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="currentColor"></path>
							</svg>
						</div>
						<h2 class="text-slate-900 dark:text-white text-xl font-bold tracking-tight">Professor Portal
						</h2>
					</div>
				</div>
				<div class="flex items-center gap-4">
					<a th:href="@{/professor/exams}"
						class="flex items-center gap-2 px-4 py-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-all font-semibold text-sm border border-transparent hover:border-slate-200 dark:hover:border-slate-700">
						<span class="material-symbols-outlined text-xl">arrow_back</span>
						<span>Back to Directory</span>
					</a>
				</div>
			</header>

			<!-- Form Content -->
			<div class="p-8 max-w-[1000px] mx-auto w-full flex flex-col gap-10">
				<!-- Page Header -->
				<section class="animate-slide-up">
					<div class="flex items-center gap-5 mb-2">
						<div
							class="size-16 rounded-3xl bg-primary text-white flex items-center justify-center shadow-2xl shadow-primary/30">
							<span class="material-symbols-outlined text-3xl"
								th:text="${exam.id != null ? 'edit_square' : 'add_task'}">add_task</span>
						</div>
						<div>
							<div
								class="flex items-center gap-2 text-primary font-bold text-xs uppercase tracking-[0.2em] mb-1">
								<span class="h-px w-6 bg-primary"></span>
								<span
									th:text="${exam.id != null ? 'Update Phase' : 'Configuration Phase'}">Configuration
									Phase</span>
							</div>
							<h3 class="text-slate-900 dark:text-white text-3xl font-extrabold tracking-tight"
								th:text="${exam.id != null ? 'Review Exam Parameters' : 'Launch New Examination'}">
								Launch New Examination</h3>
							<p class="text-slate-500 dark:text-slate-400 text-base mt-0.5">Define your assessment rules,
								timing, and student allocation.</p>
						</div>
					</div>
				</section>

				<!-- Form Card -->
				<section class="animate-slide-up" style="animation-delay: 0.1s;">
					<div
						class="bg-white dark:bg-slate-900/60 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 overflow-hidden shadow-2xl shadow-slate-200/50 dark:shadow-none glass-card">
						<form id="examForm" th:object="${exam}" class="p-10 space-y-10">
							<!-- Hidden ID field -->
							<input type="hidden" th:field="*{id}">

							<!-- Section 1: Basic Information -->
							<div class="space-y-6">
								<div
									class="flex items-center gap-3 pb-2 border-b border-slate-100 dark:border-slate-800/50">
									<span class="material-symbols-outlined text-primary text-xl">info</span>
									<h4 class="text-sm font-bold text-slate-400 uppercase tracking-widest">General
										Information</h4>
								</div>

								<div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
									<div class="md:col-span-2 space-y-2">
										<label
											class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Exam
											Title</label>
										<div class="relative group">
											<span
												class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-primary transition-colors">title</span>
											<input type="text" th:field="*{title}" required minlength="3"
												placeholder="e.g. Advanced Mathematics Mid-Term"
												class="form-input-premium pl-12">
										</div>
									</div>

									<div class="space-y-2">
										<label
											class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Assigned
											Professor</label>
										<div class="relative group">
											<span
												class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-primary transition-colors">person</span>
											<input type="text" th:field="*{professorName}" required minlength="2"
												placeholder="Full name of faculty" class="form-input-premium pl-12">
										</div>
									</div>

									<div class="space-y-2">
										<label
											class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Target
											Course</label>
										<div class="relative group">
											<span
												class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-primary transition-colors">school</span>
											<select th:field="*{courseName}" required
												class="form-input-premium pl-12 appearance-none">
												<option value="">Select Academic Path</option>
												<option value="CET(PCM)">CET (PCM)</option>
												<option value="CET(PCB)">CET (PCB)</option>
												<option value="JEE">JEE</option>
												<option value="NEET">NEET</option>
											</select>
											<span
												class="material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none">expand_more</span>
										</div>
									</div>
								</div>
							</div>

							<!-- Section 2: Scheduling & Logistics -->
							<div class="space-y-6">
								<div
									class="flex items-center gap-3 pb-2 border-b border-slate-100 dark:border-slate-800/50">
									<span
										class="material-symbols-outlined text-amber-500 text-xl">event_available</span>
									<h4 class="text-sm font-bold text-slate-400 uppercase tracking-widest">Scheduling &
										Logistics</h4>
								</div>

								<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
									<div class="space-y-2">
										<label
											class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Batch</label>
										<input type="text" th:field="*{batch}" required placeholder="Batch 2024-25"
											class="form-input-premium">
									</div>
									<div class="space-y-2">
										<label
											class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Section
											(Optional)</label>
										<input type="text" th:field="*{section}" placeholder="e.g. Alpha-1"
											class="form-input-premium">
									</div>
									<div class="space-y-2">
										<label
											class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Venue
											Type</label>
										<select th:field="*{examVenueType}" required
											class="form-input-premium appearance-none">
											<option value="">Select Location</option>
											<option value="ONLINE">Remote / Online</option>
											<option value="OFFLINE">In-Person / Hall</option>
										</select>
									</div>

									<div class="space-y-2">
										<label
											class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Examination
											Date</label>
										<input type="date" th:field="*{examDate}" required class="form-input-premium">
									</div>
									<div class="space-y-2">
										<label
											class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Assessment
											Type</label>
										<select th:field="*{examType}" required
											class="form-input-premium appearance-none">
											<option value="">Select Format</option>
											<option value="MIDTERM">Mid Term</option>
											<option value="FINAL">Final</option>
											<option value="QUIZ">Quiz / Unit Test</option>
										</select>
									</div>
									<div class="space-y-2">
										<label
											class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Question
											Set</label>
										<select th:field="*{examSet}" class="form-input-premium appearance-none">
											<option value="">Standard Set</option>
											<option value="Set A">Alpha (Set A)</option>
											<option value="Set B">Beta (Set B)</option>
											<option value="None">Generic</option>
										</select>
									</div>
								</div>
							</div>

							<!-- Section 3: Performance Metrics -->
							<div class="space-y-6">
								<div
									class="flex items-center gap-3 pb-2 border-b border-slate-100 dark:border-slate-800/50">
									<span class="material-symbols-outlined text-emerald-500 text-xl">speed</span>
									<h4 class="text-sm font-bold text-slate-400 uppercase tracking-widest">Performance
										Metrics</h4>
								</div>

								<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
									<div class="space-y-2">
										<label
											class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Duration
											(Minutes)</label>
										<div class="relative group">
											<span
												class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-emerald-500 transition-colors">timer</span>
											<input type="number" th:field="*{duration}" required min="10"
												placeholder="Active exam window" class="form-input-premium pl-12">
										</div>
									</div>
									<div class="space-y-2">
										<label
											class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Max
											Score</label>
										<div class="relative group">
											<span
												class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-emerald-500 transition-colors">military_tech</span>
											<input type="number" th:field="*{totalMarks}" required min="1"
												placeholder="Total available points" class="form-input-premium pl-12">
										</div>
									</div>
								</div>

								<div class="space-y-2 pt-4">
									<label
										class="block text-sm font-bold text-slate-700 dark:text-slate-300 ml-1">Professor
										Guidelines</label>
									<textarea rows="4" th:field="*{additionalInformation}" maxlength="250"
										placeholder="Add instructions regarding negative marking, calculator usage, etc..."
										class="form-input-premium resize-none h-32"></textarea>
								</div>
							</div>

							<!-- Action Area -->
							<div class="pt-8 space-y-6">
								<div
									class="flex items-center gap-4 p-6 rounded-3xl bg-primary/5 border border-primary/10 transition-all hover:bg-primary/10">
									<div class="relative">
										<input type="checkbox" th:field="*{enabled}" id="enableExam"
											class="custom-checkbox w-6 h-6 rounded-lg border-slate-300 text-primary focus:ring-primary focus:ring-offset-0 cursor-pointer">
									</div>
									<label for="enableExam" class="flex-1 cursor-pointer">
										<span class="text-sm font-extrabold text-slate-800 dark:text-slate-100">Publish
											Immediately</span>
										<p class="text-xs font-medium text-slate-500 dark:text-slate-400 mt-1">Checking
											this makes the exam discoverable to eligible students after processing.</p>
									</label>
									<div
										class="size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary">
										<span class="material-symbols-outlined">rocket_launch</span>
									</div>
								</div>

								<div class="flex flex-col sm:flex-row gap-4">
									<button type="submit" id="submitBtn"
										class="flex-[2] py-5 bg-primary hover:bg-blue-700 text-white rounded-2xl font-black text-lg tracking-wide transition-all duration-300 shadow-xl shadow-primary/30 hover:shadow-primary/40 hover:-translate-y-1 active:translate-y-0 flex items-center justify-center gap-3">
										<span class="material-symbols-outlined font-bold"
											th:text="${exam.id != null ? 'update' : 'rocket_launch'}">rocket_launch</span>
										<span
											th:text="${exam.id != null ? 'Apply Changes' : 'Initialize Exam'}">Initialize
											Exam</span>
									</button>
									<a th:href="@{/professor/exams}"
										class="flex-1 py-5 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-2xl font-bold transition-all border border-slate-200 dark:border-slate-700 flex items-center justify-center gap-2">
										<span class="material-symbols-outlined">cancel</span>
										<span>Cancel</span>
									</a>
								</div>
							</div>
						</form>
					</div>
				</section>

				<!-- Security Notice -->
				<section class="animate-slide-up" style="animation-delay: 0.2s;">
					<div
						class="flex items-center gap-4 px-8 py-5 rounded-3xl bg-amber-500/5 border border-amber-500/20 text-amber-700 dark:text-amber-400">
						<span class="material-symbols-outlined text-amber-500">verified_user</span>
						<p class="text-xs font-bold leading-relaxed">
							All examination data is encrypted. Modifications to exam timing will automatically trigger
							notifications to all enrolled students.
						</p>
					</div>
				</section>
			</div>
		</main>
	</div>

	<!-- Toast Container -->
	<div id="toastContainer" class="fixed bottom-8 right-8 z-[100] flex flex-col gap-3"></div>

	<script>
			// Dark Mode Utility
			(function initDarkMode() {
				const darkMode = localStorage.getItem('darkMode');
				if (darkMode === 'enabled' || (!darkMode && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
					document.documentElement.classList.add('dark');
				}
			})();

		document.addEventListener('DOMContentLoaded', function () {
			// Sidebar Dropdown
			const manageExamBtn = document.getElementById('manageExamBtn');
			const manageExamSub = document.getElementById('manageExamSub');
			const manageExamArrow = document.getElementById('manageExamArrow');

			if (manageExamBtn && manageExamSub) {
				manageExamBtn.addEventListener('click', () => {
					manageExamSub.classList.toggle('hidden');
					manageExamArrow.classList.toggle('rotate-180');
				});
			}

			// Dark Mode Toggle
			const darkModeBtn = document.getElementById('darkModeToggle');
			if (darkModeBtn) {
				darkModeBtn.addEventListener('click', () => {
					document.documentElement.classList.toggle('dark');
					localStorage.setItem('darkMode', document.documentElement.classList.contains('dark') ? 'enabled' : 'disabled');
				});
			}

			// Date Validation
			const dateInput = document.querySelector("input[type='date']");
			if (dateInput && !dateInput.value) {
				const today = new Date().toISOString().split("T")[0];
				dateInput.setAttribute("min", today);
			}

			// Form Submission
			const form = document.getElementById("examForm");
			const submitBtn = document.getElementById("submitBtn");

			form.addEventListener("submit", async function (e) {
				e.preventDefault();

				const duration = form.querySelector("[name='duration']").value;
				const marks = form.querySelector("[name='totalMarks']").value;

				if (duration < 10) return showToast("Assessment window must be > 10m", "error");
				if (marks <= 0) return showToast("Max score must be positive", "error");

				// State: Loading
				const originalBody = submitBtn.innerHTML;
				submitBtn.innerHTML = `<span class="size-6 border-3 border-white/30 border-t-white rounded-full animate-spin"></span><span>Processing...</span>`;
				submitBtn.disabled = true;

				try {
					const data = Object.fromEntries(new FormData(form).entries());
					const response = await fetch("/professor/exams/save", {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify(data)
					});

					if (response.ok) {
						showToast("Examination Parameters Synchronized!", "success");
						setTimeout(() => window.location.href = "/professor/exams", 1200);
					} else {
						throw new Error("Synchronization Error");
					}
				} catch (err) {
					showToast("Critical: Failed to save parameters", "error");
					submitBtn.innerHTML = originalBody;
					submitBtn.disabled = false;
				}
			});
		});

		function showToast(message, type) {
			const container = document.getElementById('toastContainer');
			const toast = document.createElement('div');
			const styles = {
				success: 'bg-emerald-600 shadow-emerald-500/20',
				error: 'bg-red-600 shadow-red-500/20'
			};
			const icons = { success: 'check_circle', error: 'report' };

			toast.className = `flex items-center gap-3 px-6 py-4 rounded-[1.25rem] text-white font-bold text-sm shadow-2xl transition-all duration-500 translate-x-full ${styles[type] || 'bg-slate-800'}`;
			toast.innerHTML = `<span class="material-symbols-outlined text-lg">${icons[type]}</span><span>${message}</span>`;

			container.appendChild(toast);
			setTimeout(() => toast.classList.remove('translate-x-full'), 10);
			setTimeout(() => {
				toast.classList.add('translate-x-full', 'opacity-0');
				setTimeout(() => toast.remove(), 500);
			}, 4000);
		}
	</script>
</body>

</html>